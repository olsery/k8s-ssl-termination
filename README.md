# k8s-ssl-termination

Kubernetes pod that contains two containers to provide SSL termination of services. The project structure represents the two containers.

## Let's Encrypt Container

`quay.io/robszumski/letsencrypt`

Verifies ownership of the configured domains and generates new certificates for them on start up. Intentionally dies after 30 days in order to restart for fresh certs.

Configured via environment variables:

| Variable | Default | Description |
|----------|---------|-------------|
| `DOMAINS` | _none_ | List of domains to obtain TLS certificates for |
| `EMAIL` | _none_ | Email address used to request the TLS certificate |

## Nginx Container

`quay.io/robszumski/k8s-ssl-termination`

This container has 3 roles:

1. **http** - serves challenges generated by the Let's Encrypt container.
2. **http** - redirect all other requests to https
3. **https** - terminate SSL and then proxy to a matching Kubernetes services in the `public` namespace 

## Volumes

Two volumes are mounted between the containers:

1. **challenges** - contains the unique identifiers used to validate ownership of the domains
2. **certs** - contains the newly generated certificates
